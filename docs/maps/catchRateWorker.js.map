{"version":3,"sources":["catchRateWorker.js"],"names":["roll2Cycles","onmessage","e","pokemon","data","ball","level","currentHPPercent","status","reroll1Cycles","reroll2Cycles","maxHP","baseHP","hpFactor","ballFactor","currentHPModifier","Math","min","intendedRate","ballRerollCutoff","catchRate","actualSuccesses","initialRNGByte","initialDividerWord","currentDividerWord","currentRNGByte","reroll1","reroll2","postMessage","close"],"mappings":"AAAA,MAAMA,EAAc,MAEpBC,UAAY,SAAUC,GAClB,IAAIC,EAAUD,EAAEE,KAAK,GACjBC,EAAOH,EAAEE,KAAK,GACdE,EAAQJ,EAAEE,KAAK,GACfG,EAAmBL,EAAEE,KAAK,GAC1BI,EAASN,EAAEE,KAAK,GAChBK,EAAgBP,EAAEE,KAAK,GACvBM,EAAgBR,EAAEE,KAAK,GAEvBO,GAAyC,GAA9BR,EAAQS,OAASV,EAAEE,KAAK,IAAUE,EAAQ,KAAQ,GAAKA,EAAQ,GAC1EO,EAAsB,IAARF,EAAeN,EAAKS,YAAe,EACjDC,GAAuBJ,GAASJ,EAAmB,MAAS,GAAK,GAAM,EACvEQ,EAAoB,IACpBF,EAAYA,EAAWE,GAAsB,GAEjDF,EAAWG,KAAKC,IAAIJ,EAAU,KAG9B,IAFA,IAAIK,EAAeV,EAASH,EAAKc,iBAAmBH,KAAKC,IAAId,EAAQiB,UAAY,EAAGf,EAAKc,iBAAmBX,GAAUH,EAAKc,kBAAoBN,EAAW,GAAK,IAC3JQ,EAAkB,MAAQb,EACrBc,EAAiBd,EAAQc,EAAiB,IAAKA,IACpD,IAAK,IAAIC,EAAqB,EAAGA,EAAqB,MAAOA,GAAsB,EAAG,CAGlF,IAFA,IAAIC,EAAqBD,EACrBE,EAAiBH,IAGjB,GADAG,EAAkBA,GAAkBD,IAAuB,GAAM,IAC7DnB,EAAKqB,SAAWD,EAAiB,IACjCD,EAAsBA,EAAqBf,EAAiB,UAE3D,CAAA,KAAIJ,EAAKsB,SAAWF,EAAiB,KAGtC,MAFAD,EAAsBA,EAAqBd,EAAiB,MAM/De,EAAiBjB,GAAWL,EAAQiB,YAGrCC,IADAI,EAAkBA,IADlBD,EAAsBA,EArClB,MAqCsD,SACC,GAAM,MAC5BX,EAAW,EAAI,GAIhEe,YAAY,CAACP,EAAiBH,IAC9BW","file":"../js/catchRateWorker.js","sourcesContent":["const roll2Cycles = 23664;\r\n\r\nonmessage = function (e) {\r\n    var pokemon = e.data[0];\r\n    var ball = e.data[1];\r\n    var level = e.data[2];\r\n    var currentHPPercent = e.data[3];\r\n    var status = e.data[4];\r\n    var reroll1Cycles = e.data[5];\r\n    var reroll2Cycles = e.data[6];\r\n\r\n    var maxHP = (((pokemon.baseHP + e.data[7]) * 2 * level / 100) >> 0) + level + 10;\r\n    var hpFactor = (((maxHP * 255) / ball.ballFactor) >> 0);\r\n    var currentHPModifier = (((maxHP * (currentHPPercent / 100)) >> 0) / 4) >> 0;\r\n    if (currentHPModifier > 0) {\r\n        hpFactor = (hpFactor / currentHPModifier) >> 0;\r\n    }\r\n    hpFactor = Math.min(hpFactor, 255);\r\n    var intendedRate = status / ball.ballRerollCutoff + Math.min(pokemon.catchRate + 1, ball.ballRerollCutoff - status) / ball.ballRerollCutoff * (hpFactor + 1) / 256;\r\n    var actualSuccesses = 16384 * status;\r\n    for (var initialRNGByte = status; initialRNGByte < 256; initialRNGByte++) {\r\n        for (var initialDividerWord = 0; initialDividerWord < 65536; initialDividerWord += 4) {\r\n            var currentDividerWord = initialDividerWord;\r\n            var currentRNGByte = initialRNGByte;\r\n            do {\r\n                currentRNGByte = (currentRNGByte + (currentDividerWord >>> 8)) & 0xFF;\r\n                if (ball.reroll1 && currentRNGByte > 200) {\r\n                    currentDividerWord = (currentDividerWord + reroll1Cycles) & 0xFFFF;\r\n                }\r\n                else if (ball.reroll2 && currentRNGByte > 150) {\r\n                    currentDividerWord = (currentDividerWord + reroll2Cycles) & 0xFFFF;\r\n                } else {\r\n                    break;\r\n                }\r\n            }\r\n            while (true);\r\n            if ((currentRNGByte - status) <= pokemon.catchRate) {\r\n                currentDividerWord = (currentDividerWord + roll2Cycles) & 0xFFFF;\r\n                currentRNGByte = (currentRNGByte + (currentDividerWord >>> 8)) & 0xFF;\r\n                actualSuccesses += currentRNGByte <= hpFactor ? 1 : 0;\r\n            }\r\n        }\r\n    }\r\n    postMessage([actualSuccesses, intendedRate]);\r\n    close();\r\n}"]}